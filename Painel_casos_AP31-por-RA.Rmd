---
title: "Painel Síndrome Gripal 2021"
output: 
  flexdashboard::flex_dashboard:
    theme: cerulean
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE, echo=FALSE}
library(flexdashboard)
# instalar os pacotes no R antes de rodar
library(readxl)
library(dplyr)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(aweek)
library(knitr)
library(kableExtra)
library("tm")
library("SnowballC")
library("wordcloud")
library("wordcloud2")
library("RColorBrewer")

# opa! lembre de mudar diretorio
dados <- read_excel("COVID19_CAP31.xlsx")


dados <- dados %>%
  mutate(FXETARIA = cut(IDADE, breaks = c(0, 10, 20, 30, 40, 50, 60, 70,  Inf), right = FALSE,
         labels = c("0 a 9", "10 a 19", "20 a 29", "30 a 39", "40 a 49", "50 a 59", "60 a 69", "70 ou +")))




dados <- dados %>%
  mutate(SEXO = as.factor(SEXO),
         RA = factor(RA),
         TIPO = factor(TIPO),
         FEBRE = factor(FEBRE),
         TOSSE = factor(TOSSE),
         DOR.GARGANTA = factor(DOR.GARGANTA),
         CORIZA = factor(CORIZA),
         DIF.RESPIRAR = factor(DIF.RESPIRAR),
         FR.HAS = factor(FR.HAS), # HIPERTENSAO ARTERIAL
         FR.DIABETTES = factor(FR.DIABETTES),
         FR.OBESIDADE = factor(FR.OBESIDADE),
         FR.DPCO = factor(FR.DPCO),
         FR.OUTROS = factor(FR.OUTROS))


options(OutDec= ",")

dados <- dados %>%
  mutate(TIPO= factor(TIPO, levels = c("COVID-19", "SG", "SRAG", "Sem informação")))

dados$TIPO <- dados$TIPO %>% tidyr::replace_na("Sem informação")

```

ÁREA DE PLANEJAMENTO (AP) 3.1
=====================================  

Column {data-width= 200}
-----------------------------------------------------------------------


### Data

```{r}
valueBox(format(Sys.Date(), "%d/%m/%Y"), icon = "fa-calendar", color= "white")
```

### Nº de casos AP 3.1

```{r}
ncasos <- nrow(dados) 

valueBox(ncasos, icon = "fa-calculator", color = "lightblue")
```


### Nº de casos por Região Administrativa (RA)

```{r}
dt.RA <- dados %>%
  group_by(RA) %>%
  tally

dt.RA <- dt.RA %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

colnames(dt.RA) <- c("RA", "Nº de casos", "%")

kbl(dt.RA, align = "lcc") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),  font_size = 16)

```



### AP 3.1 - Casos segundo Tipo de Notificação


```{r fig.width= 8}

# TIPO DE NOTIFICAÇÃO

dados.tipo <- dados %>%
  group_by(TIPO) %>%
  tally()

dados.tipo$`%` <- round(dados.tipo$n/sum(dados.tipo$n)*100,1)


ggplot(dados.tipo) +
  aes(x = reorder(TIPO, -`%`), weight = `%`) +
  geom_bar(fill = "#999999") +
  geom_text(aes(label = paste0(dados.tipo$`%`,"%"), y = dados.tipo$`%` + 1),
    position = position_dodge(0.9), size= 5, vjust = 0) +
  labs(y = "%", x = "Tipo de Notificação") +
  theme_classic(base_size = 20)

```

Column {data-width= 500}
-----------------------------------------------------------------------

### AP 3.1 - Casos segundo SE dos 1os sintomas

```{r, fig.width = 10}

## semana epidemiolo 1os sintomas

dados <- dados %>%
  mutate(`SEMANA EPIDEMIOLÓGICA` = epiweek(DT_PRISIN),
         ANO = year(DT_PRISIN))


dados$`SEMANA EPIDEMIOLÓGICA` <- as.factor(dados$`SEMANA EPIDEMIOLÓGICA`)


dados.SE <- dados %>% 
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>%
  tally

dados.SE <- dados.SE %>%  
  filter(ANO >= 2020 & ANO <= 2021) %>% # REMOVER ANOS ANTES DE 2020 E MAIOR 2021
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>% 
  summarise(sum_week_value= sum(n)) %>% 
  ungroup() %>% 
  #using aweek
  mutate(epi_date=get_date(week = `SEMANA EPIDEMIOLÓGICA`, year = ANO),
         wik_date=date2week(epi_date)
  ) 

dados.SE %>% 
  slice(-(1:3)) %>% 
  ggplot(aes(epi_date, weight = sum_week_value)) + 
  geom_bar(fill = "SeaGreen3") + 
  scale_x_date(date_breaks="1 month", date_labels = "%U-%y",
          limits = as.Date(c("2021-01-01","2021-10-15"))) + #NOTE QUE PRECISA AJUSTAR P SEU EXEMPLO
  labs( x = "SE dos 1os sintomas", y = "Frequência") +
  theme_minimal(base_size = 18)+
  theme(axis.text.x = element_text(angle = 90))
```



### AP 3.1 - Faixa etária (em anos) segundo Gênero


```{r  }

piramide <- dados %>%
  group_by(FXETARIA, SEXO) %>%
  tally

piramide$Sexo  <- piramide$SEXO
piramide$FXETARIA  <- as.factor(piramide$FXETARIA)
piramide$SEXO  <- as.factor(piramide$SEXO)

piramide$FXETARIA  <- factor(piramide$FXETARIA)
piramide$SEXO  <- factor(piramide$SEXO)

ggplot(data = piramide, 
       mapping = aes(x = FXETARIA,
                     y = ifelse(test = Sexo == "Masculino",  yes = n, no = -n), 
                     fill = Sexo)) +
  geom_bar(stat = "identity") +
  ggtitle("") +
  scale_y_continuous(labels = abs, limits = (max(piramide$n))* c(-1,1)) +
  labs(y = "Número de casos", x = "Faixa etária (em anos)") +
  scale_fill_brewer(palette = "OrRd") +
  coord_flip() +
  theme_classic(base_size = 18) +
  theme(legend.position= "bottom")

```




Column {data-width= 300}
-----------------------------------------------------------------------


### AP 3.1 - Proporção dos sintomas autorreferidos (%)


```{r fig.width= 10}
# sintomas


d.tosse <- dados %>%
  group_by(TOSSE) %>%
  tally

d.tosse <- d.tosse %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.febre <- dados %>%
  group_by(FEBRE) %>%
  tally

d.febre <- d.febre %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.coriza <- dados %>%
  group_by(CORIZA) %>%
  tally

d.coriza <- d.coriza %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.garganta <- dados %>%
  group_by(DOR.GARGANTA) %>%
  tally

d.garganta <- d.garganta %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.difculresp <- dados %>%
  group_by(DIF.RESPIRAR) %>%
  tally

d.difculresp <- d.difculresp %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))




sintomas.n <- rbind(d.tosse[2,2], d.garganta[2,2], d.febre[2,2],  d.coriza[2,2], d.difculresp[2,2])


sintomas.porcent <- rbind(d.tosse[2,3], d.garganta[2,3], d.febre[2,3],  d.coriza[2,3], d.difculresp[2,3])


sintomas.nome <- c( "Tosse", "Dor de garganta", "Febre", "Coriza", "Dificuldade para respirar")


sintomas <- cbind(sintomas.nome, sintomas.n, sintomas.porcent)

colnames(sintomas) <- c("Sintomas", "Frequência", "%")

ggplot(sintomas) +
  aes(x = reorder(Sintomas, -`%`), weight = `%`) +
  geom_bar(fill =  "SkyBlue1") +
  coord_flip() +
  labs(x = "Sintomas", y = "%") +
  ylim(0, max(sintomas$`%`)+10)+
  geom_text(aes(label = paste0(sintomas$`%`,"%"), y = sintomas$`%`),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```

### AP 3.1 - Proporção dos Fatores de Risco autorreferidos (%)

```{r, fig.width = 10}

d.has <- dados %>%
  group_by(FR.HAS) %>%
  tally

d.has <- d.has %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.obeso <- dados %>%
  group_by(FR.OBESIDADE) %>%
  tally

d.obeso <- d.obeso %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.DM <- dados %>%
  group_by(FR.DIABETTES) %>%
  tally

d.DM <- d.DM %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.dpco <- dados %>%
  group_by(FR.DPCO) %>%
  tally

d.dpco <- d.dpco %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.outros <- dados %>%
  group_by(FR.OUTROS) %>%
  tally

d.outros <- d.outros %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))



fatorrisco.n <- rbind(d.has[2,2], d.DM[2,2], d.dpco[2,2], d.obeso[2,2], d.outros[2,2])


fatorrisco.porcent <- rbind(d.has[2,3], d.DM[2,3], d.dpco[2,3], d.obeso[2,3], d.outros[2,3])


fatorrisco.nome <- c( "Hipertensão arterial", "Diabettes", "DPCO", "Obesidade", "Outros")


fatorrisco <- cbind(fatorrisco.nome, fatorrisco.n, fatorrisco.porcent)

colnames(fatorrisco) <- c("Fator de Risco", "Frequência", "Porcent")


ggplot(fatorrisco) +
  aes(x = reorder(`Fator de Risco`, -Porcent), weight = Porcent) +
  geom_bar(fill =  "Thistle1") +
  coord_flip() +
  labs(x = "Fatores de risco", y = "%") +
  ylim(0, max(fatorrisco$Porcent)+10)+
  geom_text(aes(label = paste0(Porcent,"%"), y = Porcent),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```




RA Ramos {data-icon="fa-signal"}
=====================================  

Column {data-width=200}
-----------------------------------------------------------------------
### RA

```{r}
valueBox("Ramos", icon = "fa-pencil", color= "white")
```

### Data

```{r}
valueBox(format(Sys.Date(), "%d/%m/%Y"), icon = "fa-calendar", color = "purple")
```

### Nº de casos

```{r}

ncasos22 <- dados %>%
  filter(RA == "Ramos") %>% tally

valueBox(ncasos22, icon = "fa-calculator", color = "lightblue")
```


### RA Ramos - Tipo de Notificação


```{r fig.width= 10}

# TIPO DE NOTIFICAÇÃO

  dados.tipo.ramos <- dados %>%
   filter(RA == "Ramos")   %>%
   group_by(TIPO) %>%
   tally()

dados.tipo.ramos$`%` <- round(dados.tipo.ramos$n/sum(dados.tipo.ramos$n)*100,1)

colnames(dados.tipo.ramos) <- c("Tipo de notificação", "Nº de casos", "%")

kbl(dados.tipo.ramos, align = "lcc") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),  font_size = 16)



```



Column {data-width=450}
-----------------------------------------------------------------------

### RA Ramos - Casos segundo SE dos 1os sintomas

```{r, fig.width = 10}

## semana epidemiolo 1os sintomas

dados.1 <- dados %>%
  filter(RA == "Ramos")   %>%
  mutate(`SEMANA EPIDEMIOLÓGICA` = epiweek(DT_PRISIN),
         ANO = year(DT_PRISIN))


dados.1$`SEMANA EPIDEMIOLÓGICA` <- as.factor(dados.1$`SEMANA EPIDEMIOLÓGICA`)


dados.SE <- dados.1 %>% 
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>%
  tally

dados.SE <- dados.SE %>% 
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>% 
  summarise(sum_week_value=sum(n)) %>% 
  ungroup() %>% 
  #using aweek
  mutate(epi_date=get_date(week = `SEMANA EPIDEMIOLÓGICA`,year = ANO),
         wik_date=date2week(epi_date)
  ) 


dados.SE %>% 
  slice(-(1:3)) %>% 
  ggplot(aes(epi_date, weight = sum_week_value)) + 
  geom_bar(fill = "SeaGreen3") + 
  scale_x_date(date_breaks="1 month", date_labels = "%U-%y",
               limits = as.Date(c("2021-01-01","2021-10-15"))) +
  labs( x = "SE da 1os sintomas", y = "Frequência") +
  theme_minimal(base_size = 18) +
  theme(axis.text.x = element_text(angle = 90))

```


### RA Ramos - Faixa etária (em anos) segundo Gênero

```{r}
piramide <- dados %>%
  filter(RA == "Ramos") %>%
  group_by(FXETARIA, SEXO) %>%
  tally

piramide$Sexo  <- piramide$SEXO
piramide$FXETARIA  <- as.factor(piramide$FXETARIA)
piramide$SEXO  <- as.factor(piramide$SEXO)

piramide$FXETARIA  <- factor(piramide$FXETARIA)
piramide$SEXO  <- factor(piramide$SEXO)

ggplot(data = piramide, 
       mapping = aes(x = FXETARIA,
                     y = ifelse(test = SEXO == "Masculino",  yes = n, no = -n), 
                     fill = SEXO)) +
  geom_bar(stat = "identity") +
  ggtitle("") +
  scale_y_continuous(labels = abs, limits = (max(piramide$n))* c(-1,1)) +
  labs(y = "Número de casos", x = "Faixa etária (em anos)") +
  scale_fill_brewer(palette = "OrRd") +
  coord_flip() +
  theme_classic(base_size = 18) +
  theme(legend.position= "bottom")



```



Column {data-width=350} 
-----------------------------------------------------------------------


### RA Ramos - Proporção de Sintomas autorreferidos (%)


```{r fig.width= 10}
d.tosse <- dados %>%
  filter(RA == "Ramos")   %>%
  group_by(TOSSE) %>%
  tally

d.tosse <- d.tosse %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.febre <- dados %>%
  filter(RA == "Ramos")   %>%
  group_by(FEBRE) %>%
  tally

d.febre <- d.febre %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.coriza <- dados %>%
  filter(RA == "Ramos")   %>%
  group_by(CORIZA) %>%
  tally

d.coriza <- d.coriza %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.garganta <- dados %>%
  filter(RA == "Ramos")   %>%
  group_by(DOR.GARGANTA) %>%
  tally

d.garganta <- d.garganta %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.difculresp <- dados %>%
  filter(RA == "Ramos")   %>%
  group_by(DIF.RESPIRAR) %>%
  tally

d.difculresp <- d.difculresp %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

sintomas.n <- rbind(d.tosse[2,2], d.garganta[2,2], d.febre[2,2],  d.coriza[2,2], d.difculresp[2,2])

sintomas.porcent <- rbind(d.tosse[2,3], d.garganta[2,3], d.febre[2,3],  d.coriza[2,3], d.difculresp[2,3])

sintomas.nome <- c( "Tosse", "Dor de garganta", "Febre", "Coriza", "Dificuldade para respirar")

sintomas <- cbind(sintomas.nome, sintomas.n, sintomas.porcent)

colnames(sintomas) <- c("Sintomas", "Frequência", "%")

ggplot(sintomas) +
  aes(x = reorder(Sintomas, -`%`), weight = `%`) +
  geom_bar(fill =  "SkyBlue1") + 
  coord_flip() +
  labs(x = "Sintomas", y = "%") +
  ylim(0, max(sintomas$`%`)+10)+
  geom_text(aes(label = paste0(sintomas$`%`,"%"), y = sintomas$`%`),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)


```


### RA Ramos - Proporção dos Fatores de Risco autorreferidos (%)

```{r, fig.width = 10}



d.has <- dados %>%
  filter(RA == "Ramos")%>%
  group_by(FR.HAS) %>%
  tally

d.has <- d.has %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.obeso <- dados %>%
  filter(RA == "Ramos")%>%
  group_by(FR.OBESIDADE) %>%
  tally

d.obeso <- d.obeso %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.DM <- dados %>%
  filter(RA == "Ramos")%>%
  group_by(FR.DIABETTES) %>%
  tally

d.DM <- d.DM %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.dpco <- dados %>%
  filter(RA == "Ramos")%>%
  group_by(FR.DPCO) %>%
  tally

d.dpco <- d.dpco %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.outros <- dados %>%
  filter(RA == "Ramos")%>%
  group_by(FR.OUTROS) %>%
  tally

d.outros <- d.outros %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))



fatorrisco.n <- rbind(d.has[2,2], d.DM[2,2], d.dpco[2,2], d.obeso[2,2], d.outros[2,2])


fatorrisco.porcent <- rbind(d.has[2,3], d.DM[2,3], d.dpco[2,3], d.obeso[2,3], d.outros[2,3])


fatorrisco.nome <- c( "Hipertensão arterial", "Diabettes", "DPCO", "Obesidade", "Outros")


fatorrisco <- cbind(fatorrisco.nome, fatorrisco.n, fatorrisco.porcent)

colnames(fatorrisco) <- c("Fator de Risco", "Frequência", "Porcent")


ggplot(fatorrisco) +
  aes(x = reorder(`Fator de Risco`, -Porcent), weight = Porcent) +
  geom_bar(fill =  "Thistle1") +
  coord_flip() +
  labs(x = "Fatores de risco", y = "%") +
  ylim(0, max(fatorrisco$Porcent)+10)+
  geom_text(aes(label = paste0(Porcent,"%"), y = Porcent),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```

RA Penha {data-icon="fa-signal"}
=====================================  

Column {data-width=200}
-----------------------------------------------------------------------
### RA
```{r}
valueBox("Penha", icon = "fa-pencil", color= "white")
```

### Data

```{r}
valueBox(format(Sys.Date(), "%d/%m/%Y"), icon = "fa-calendar ", color= "purple")
```

### Nº de casos

```{r}

ncasos22 <- dados %>%
  filter(RA == "Penha") %>% tally

valueBox(ncasos22, icon = "fa-calculator", color = "lightblue")
```


### RA Penha - Tipo de Notificação


```{r fig.width= 10}

# TIPO DE NOTIFICAÇÃO

dados.tipo.penha <- dados %>%
  filter(RA == "Penha")   %>%
   group_by(TIPO) %>%
    tally()

dados.tipo.penha <- dados.tipo.penha %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

colnames(dados.tipo.penha) <- c("Tipo de notificação", "Nº de casos", "%")

kbl(dados.tipo.penha, align = "lcc") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),  font_size = 16)



```

Column {data-width=450}
-----------------------------------------------------------------------

### RA Penha - Casos segundo SE dos 1os sintomas

```{r, fig.width = 10}
## semana epidemiolo notificação

dados.2 <- dados %>%
  filter(RA == "Penha")   %>%
  mutate(`SEMANA EPIDEMIOLÓGICA` = epiweek(DT_PRISIN),
         ANO = year(DT_PRISIN))


dados.2$`SEMANA EPIDEMIOLÓGICA` <- as.factor(dados.2$`SEMANA EPIDEMIOLÓGICA`)


dados.SE <- dados.2 %>% 
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>%
  tally

dados.SE <- dados.SE %>% 
  filter(ANO >= 2020 & ANO <= 2021) %>%
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>% 
  summarise(sum_week_value= sum(n)) %>% 
  ungroup() %>% 
  #using aweek
  mutate(epi_date=get_date(week = `SEMANA EPIDEMIOLÓGICA`, year = ANO),
         wik_date=date2week(epi_date)
  ) 

dados.SE %>% 
  slice(-(1:3)) %>% 
  ggplot(aes(epi_date, weight = sum_week_value)) + 
  geom_bar(fill = "SeaGreen3") + 
  scale_x_date(date_breaks="1 month", date_labels = "%U-%y",
               limits = as.Date(c("2021-01-01","2021-10-15"))) +
  labs( x = "SE dos 1os sintomas", y = "Frequência") +
  theme_minimal(base_size = 18)+
  theme(axis.text.x = element_text(angle = 90))
```


### RA Penha - Faixa etária (em anos) segundo Gênero

```{r}

piramide <- dados %>%
  filter(RA == "Penha" ) %>%
  group_by(FXETARIA, SEXO) %>%
  tally

piramide$Sexo  <- piramide$SEXO
piramide$FXETARIA  <- as.factor(piramide$FXETARIA)
piramide$SEXO  <- as.factor(piramide$SEXO)

piramide$FXETARIA  <- factor(piramide$FXETARIA)
piramide$SEXO  <- factor(piramide$SEXO)

ggplot(data = piramide, 
       mapping = aes(x = FXETARIA,
                     y = ifelse(test = Sexo == "Masculino",  yes = n, no = -n), 
                     fill = Sexo)) +
  geom_bar(stat = "identity") +
  ggtitle("") +
  scale_y_continuous(labels = abs, limits = (max(piramide$n))* c(-1,1)) +
  labs(y = "Número de casos", x = "Faixa etária (em anos)") +
  scale_fill_brewer(palette = "OrRd") +
  coord_flip() +
  theme_classic(base_size = 18) +
  theme(legend.position= "bottom")



```


Column {data-width=350} 
-----------------------------------------------------------------------



### RA Penha - Proporção de Sintomas autorreferidos (%)


```{r fig.width= 10}

d.tosse <- dados %>%
  filter(RA == "Penha")   %>%
  group_by(TOSSE) %>%
  tally

d.tosse <- d.tosse %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.febre <- dados %>%
  filter(RA == "Penha")   %>%
  group_by(FEBRE) %>%
  tally

d.febre <- d.febre %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.coriza <- dados %>%
  filter(RA == "Penha")   %>%
  group_by(CORIZA) %>%
  tally

d.coriza <- d.coriza %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.garganta <- dados %>%
  filter(RA == "Penha")   %>%
  group_by(DOR.GARGANTA) %>%
  tally

d.garganta <- d.garganta %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.difculresp <- dados %>%
  filter(RA == "Penha")   %>%
  group_by(DIF.RESPIRAR) %>%
  tally

d.difculresp <- d.difculresp %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

sintomas.n <- rbind(d.tosse[2,2], d.garganta[2,2], d.febre[2,2],  d.coriza[2,2], d.difculresp[2,2])

sintomas.porcent <- rbind(d.tosse[2,3], d.garganta[2,3], d.febre[2,3],  d.coriza[2,3], d.difculresp[2,3])

sintomas.nome <- c( "Tosse", "Dor de garganta", "Febre", "Coriza", "Dificuldade para respirar")

sintomas <- cbind(sintomas.nome, sintomas.n, sintomas.porcent)

colnames(sintomas) <- c("Sintomas", "Frequência", "%")

ggplot(sintomas) +
  aes(x = reorder(Sintomas, -`%`), weight = `%`) +
  geom_bar(fill =  "SkyBlue1") +
  coord_flip() +
  labs(x = "Sintomas", y = "%") +
  ylim(0, max(sintomas$`%`)+10)+
  geom_text(aes(label = paste0(sintomas$`%`,"%"), y = sintomas$`%`),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```


### RA Penha - Proporção dos Fatores de Risco autorreferidos (%)

```{r, fig.width = 10}


d.has <- dados %>%
  filter(RA == "Penha")%>%
  group_by(FR.HAS) %>%
  tally

d.has <- d.has %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.obeso <- dados %>%
  filter(RA == "Penha")%>%
  group_by(FR.OBESIDADE) %>%
  tally

d.obeso <- d.obeso %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.DM <- dados %>%
  filter(RA == "Penha")%>%
  group_by(FR.DIABETTES) %>%
  tally

d.DM <- d.DM %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.dpco <- dados %>%
  filter(RA == "Penha")%>%
  group_by(FR.DPCO) %>%
  tally

d.dpco <- d.dpco %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.outros <- dados %>%
  filter(RA == "Penha")%>%
  group_by(FR.OUTROS) %>%
  tally

d.outros <- d.outros %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))



fatorrisco.n <- rbind(d.has[2,2], d.DM[2,2], d.dpco[2,2], d.obeso[2,2], d.outros[2,2])


fatorrisco.porcent <- rbind(d.has[2,3], d.DM[2,3], d.dpco[2,3], d.obeso[2,3], d.outros[2,3])


fatorrisco.nome <- c( "Hipertensão arterial", "Diabettes", "DPCO", "Obesidade", "Outros")


fatorrisco <- cbind(fatorrisco.nome, fatorrisco.n, fatorrisco.porcent)

colnames(fatorrisco) <- c("Fator de Risco", "Frequência", "Porcent")


ggplot(fatorrisco) +
  aes(x = reorder(`Fator de Risco`, -Porcent), weight = Porcent) +
  geom_bar(fill =  "Thistle1") +
  coord_flip() +
  labs(x = "Fatores de risco", y = "%") +
  ylim(0, max(fatorrisco$Porcent)+10)+
  geom_text(aes(label = paste0(Porcent,"%"), y = Porcent),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```

RA Ilha {data-icon="fa-signal"}
=====================================  

Column {data-width=200}
-----------------------------------------------------------------------
### RA
```{r}
valueBox("Ilha do Governador", icon = "fa-pencil", color= "white")
```

### Data

```{r}
valueBox(format(Sys.Date(), "%d/%m/%Y"), icon = "fa-calendar ", color= "purple")
```

### Nº de casos

```{r}

ncasos22 <- dados %>%
  filter(RA == "Ilha do Governador") %>% tally

valueBox(ncasos22, icon = "fa-calculator", color = "lightblue")
```


### RA Ilha - Tipo de Notificação


```{r fig.width= 10}

# TIPO DE NOTIFICAÇÃO


dados.tipo.ig <- dados %>%
  filter(RA == "Ilha do Governador")   %>%
   group_by(TIPO) %>%
    tally()

dados.tipo.ig$`%` <- round(dados.tipo.ig$n/sum(dados.tipo.ig$n)*100,1)


colnames(dados.tipo.ig) <- c("Tipo de notificação", "Nº de casos", "%")

kbl(dados.tipo.ig, align = "lcc") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),  font_size = 16)


```

Column {data-width=450}
-----------------------------------------------------------------------

### RA Ilha - Casos segundo SE dos 1os sintomas

```{r, fig.width = 10}

## semana epidemiolo notificação

dados.3 <- dados %>%
  filter(RA == "Ilha do Governador")   %>%
  mutate(`SEMANA EPIDEMIOLÓGICA` = epiweek(DT_PRISIN),
         ANO = year(DT_PRISIN))


dados.3$`SEMANA EPIDEMIOLÓGICA` <- as.factor(dados.3$`SEMANA EPIDEMIOLÓGICA`)


dados.SE <- dados.3 %>% 
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>%
  tally

dados.SE <- dados.SE %>% 
  filter(ANO >= 2020 & ANO <= 2021) %>%
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>% 
  summarise(sum_week_value= sum(n)) %>% 
  ungroup() %>% 
  #using aweek
  mutate(epi_date=get_date(week = `SEMANA EPIDEMIOLÓGICA`, year = ANO),
         wik_date=date2week(epi_date)
  ) 

dados.SE %>% 
  slice(-(1:3)) %>% 
  ggplot(aes(epi_date, weight = sum_week_value)) + 
  geom_bar(fill = "SeaGreen3") + 
  scale_x_date(date_breaks="1 month", date_labels = "%U-%y",
               limits = as.Date(c("2021-01-01","2021-10-15"))) +
  labs( x = "SE dos 1os sintomas", y = "Frequência") +
  theme_minimal(base_size = 18)
```





### RA Ilha - Faixa etária (em anos) segundo Gênero

```{r}

piramide <- dados %>%
  filter(RA == "Ilha do Governador" ) %>%
  group_by(FXETARIA, SEXO) %>%
  tally

piramide$Sexo  <- piramide$SEXO
piramide$FXETARIA  <- as.factor(piramide$FXETARIA)
piramide$SEXO  <- as.factor(piramide$SEXO)

piramide$FXETARIA  <- factor(piramide$FXETARIA)
piramide$SEXO  <- factor(piramide$SEXO)

ggplot(data = piramide, 
       mapping = aes(x = FXETARIA,
                     y = ifelse(test = Sexo == "Masculino",  yes = n, no = -n), 
                     fill = Sexo)) +
  geom_bar(stat = "identity") +
  ggtitle("") +
  scale_y_continuous(labels = abs, limits = (max(piramide$n))* c(-1,1)) +
  labs(y = "Número de casos", x = "Faixa etária (em anos)") +
  scale_fill_brewer(palette = "OrRd") +
  coord_flip() +
  theme_classic(base_size = 18) +
  theme(legend.position= "bottom")


```



Column {data-width=350} 
-----------------------------------------------------------------------

### RA Ilha - Proporção de Sintomas autorreferidos (%)


```{r fig.width= 10}

d.tosse <- dados %>%
  filter(RA == "Ilha do Governador")   %>%
  group_by(TOSSE) %>%
  tally

d.tosse <- d.tosse %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.febre <- dados %>%
  filter(RA == "Ilha do Governador")   %>%
  group_by(FEBRE) %>%
  tally

d.febre <- d.febre %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.coriza <- dados %>%
  filter(RA == "Ilha do Governador")   %>%
  group_by(CORIZA) %>%
  tally

d.coriza <- d.coriza %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.garganta <- dados %>%
  filter(RA == "Ilha do Governador")   %>%
  group_by(DOR.GARGANTA) %>%
  tally

d.garganta <- d.garganta %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.difculresp <- dados %>%
  filter(RA == "Ilha do Governador")   %>%
  group_by(DIF.RESPIRAR) %>%
  tally

d.difculresp <- d.difculresp %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

sintomas.n <- rbind(d.tosse[2,2], d.garganta[2,2], d.febre[2,2],  d.coriza[2,2], d.difculresp[2,2])

sintomas.porcent <- rbind(d.tosse[2,3], d.garganta[2,3], d.febre[2,3],  d.coriza[2,3], d.difculresp[2,3])

sintomas.nome <- c( "Tosse", "Dor de garganta", "Febre", "Coriza", "Dificuldade para respirar")

sintomas <- cbind(sintomas.nome, sintomas.n, sintomas.porcent)

colnames(sintomas) <- c("Sintomas", "Frequência", "%")

ggplot(sintomas) +
  aes(x = reorder(Sintomas, -`%`), weight = `%`) +
  geom_bar(fill =  "SkyBlue1") +
  coord_flip() +
  labs(x = "Sintomas", y = "%") +
  ylim(0, max(sintomas$`%`)+10)+
  geom_text(aes(label = paste0(sintomas$`%`,"%"), y = sintomas$`%`),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```


### RA Ilha - Proporção dos Fatores de Risco autorreferidos (%)

```{r, fig.width = 10}


d.has <- dados %>%
  filter(RA == "Ilha do Governador")%>%
  group_by(FR.HAS) %>%
  tally

d.has <- d.has %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.obeso <- dados %>%
  filter(RA == "Ilha do Governador")%>%
  group_by(FR.OBESIDADE) %>%
  tally

d.obeso <- d.obeso %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.DM <- dados %>%
  filter(RA == "Ilha do Governador")%>%
  group_by(FR.DIABETTES) %>%
  tally

d.DM <- d.DM %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.dpco <- dados %>%
  filter(RA == "Ilha do Governador")%>%
  group_by(FR.DPCO) %>%
  tally

d.dpco <- d.dpco %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.outros <- dados %>%
  filter(RA == "Ilha do Governador")%>%
  group_by(FR.OUTROS) %>%
  tally

d.outros <- d.outros %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))



fatorrisco.n <- rbind(d.has[2,2], d.DM[2,2], d.dpco[2,2], d.obeso[2,2], d.outros[2,2])


fatorrisco.porcent <- rbind(d.has[2,3], d.DM[2,3], d.dpco[2,3], d.obeso[2,3], d.outros[2,3])


fatorrisco.nome <- c( "Hipertensão arterial", "Diabettes", "DPCO", "Obesidade", "Outros")


fatorrisco <- cbind(fatorrisco.nome, fatorrisco.n, fatorrisco.porcent)

colnames(fatorrisco) <- c("Fator de Risco", "Frequência", "Porcent")


ggplot(fatorrisco) +
  aes(x = reorder(`Fator de Risco`, -Porcent), weight = Porcent) +
  geom_bar(fill =  "Thistle1") +
  coord_flip() +
  labs(x = "Fatores de risco", y = "%") +
  ylim(0, max(fatorrisco$Porcent)+10)+
  geom_text(aes(label = paste0(Porcent,"%"), y = Porcent),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```

RA C. Alemão {data-icon="fa-signal"}
=====================================  

Column {data-width=200}
-----------------------------------------------------------------------
### RA
```{r}
valueBox("Complexo do Alemão", icon = "fa-pencil", color= "white")
```

### Data

```{r}
valueBox(format(Sys.Date(), "%d/%m/%Y"), icon = "fa-calendar ", color= "purple")
```

### Nº de casos

```{r}

ncasos22 <- dados %>%
  filter(RA == "Complexo do Alemão") %>% tally

valueBox(ncasos22, icon = "fa-calculator", color = "lightblue")
```

### RA C. Alemão - Tipo de Notificação


```{r fig.width= 10}

# TIPO DE NOTIFICAÇÃO


dados.tipo.ca <- dados %>%
  filter(RA == "Complexo do Alemão")   %>%
   group_by(TIPO) %>%
    tally()

dados.tipo.ca$`%` <- round(dados.tipo.ca$n/sum(dados.tipo.ca$n)*100,1)



colnames(dados.tipo.ca) <- c("Tipo de notificação", "Nº de casos", "%")

kbl(dados.tipo.ca, align = "lcc") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),  font_size = 16)


```



Column {data-width=450}
-----------------------------------------------------------------------

### RA C. Alemão - Casos segundo SE dos 1os sintomas

```{r, fig.width = 10}

## semana epidemiolo notificação

dados.4 <- dados %>%
  filter(RA == "Complexo do Alemão")   %>%
  mutate(`SEMANA EPIDEMIOLÓGICA` = epiweek(DT_PRISIN),
         ANO = year(DT_PRISIN))


dados.4$`SEMANA EPIDEMIOLÓGICA` <- as.factor(dados.4$`SEMANA EPIDEMIOLÓGICA`)


dados.SE <- dados.4 %>% 
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>%
  tally

dados.SE <- dados.SE %>% 
  filter(ANO >= 2020 & ANO <= 2021) %>%
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>% 
  summarise(sum_week_value= sum(n)) %>% 
  ungroup() %>% 
  #using aweek
  mutate(epi_date=get_date(week = `SEMANA EPIDEMIOLÓGICA`, year = ANO),
         wik_date=date2week(epi_date)
  ) 

dados.SE %>% 
  slice(-(1:3)) %>% 
  ggplot(aes(epi_date, weight = sum_week_value)) + 
  geom_bar(fill = "SeaGreen3") + 
  scale_x_date(date_breaks="1 month", date_labels = "%U-%y",
               limits = as.Date(c("2021-01-01","2021-10-15"))) +
  labs( x = "SE dos 1os sintomas", y = "Frequência") +
  theme_minimal(base_size = 18)+
  theme(axis.text.x = element_text(angle = 90))
```




### RA C. Alemão - Faixa etária (em anos) segundo Gênero

```{r}

piramide <- dados %>%
  filter(RA == "Complexo do Alemão" ) %>%
  group_by(FXETARIA, SEXO) %>%
  tally

piramide$Sexo  <- piramide$SEXO
piramide$FXETARIA  <- as.factor(piramide$FXETARIA)
piramide$SEXO  <- as.factor(piramide$SEXO)

piramide$FXETARIA  <- factor(piramide$FXETARIA)
piramide$SEXO  <- factor(piramide$SEXO)

ggplot(data = piramide, 
       mapping = aes(x = FXETARIA,
                     y = ifelse(test = Sexo == "Masculino",  yes = n, no = -n), 
                     fill = Sexo)) +
  geom_bar(stat = "identity") +
  ggtitle("") +
  scale_y_continuous(labels = abs, limits = (max(piramide$n))* c(-1,1)) +
  labs(y = "Número de casos", x = "Faixa etária (em anos)") +
  scale_fill_brewer(palette = "OrRd") +
  coord_flip() +
  theme_classic(base_size = 18) +
  theme(legend.position= "bottom")


```



Column {data-width=350} 
-----------------------------------------------------------------------

### RA C. Alemão - Proporção de Sintomas autorreferidos (%)


```{r fig.width= 10}

d.tosse <- dados %>%
  filter(RA == "Complexo do Alemão")   %>%
  group_by(TOSSE) %>%
  tally

d.tosse <- d.tosse %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.febre <- dados %>%
  filter(RA == "Complexo do Alemão")   %>%
  group_by(FEBRE) %>%
  tally

d.febre <- d.febre %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.coriza <- dados %>%
  filter(RA == "Complexo do Alemão")   %>%
  group_by(CORIZA) %>%
  tally

d.coriza <- d.coriza %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.garganta <- dados %>%
  filter(RA == "Complexo do Alemão")   %>%
  group_by(DOR.GARGANTA) %>%
  tally

d.garganta <- d.garganta %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.difculresp <- dados %>%
  filter(RA == "Complexo do Alemão")   %>%
  group_by(DIF.RESPIRAR) %>%
  tally

d.difculresp <- d.difculresp %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

sintomas.n <- rbind(d.tosse[2,2], d.garganta[2,2], d.febre[2,2],  d.coriza[2,2], d.difculresp[2,2])

sintomas.porcent <- rbind(d.tosse[2,3], d.garganta[2,3], d.febre[2,3],  d.coriza[2,3], d.difculresp[2,3])

sintomas.nome <- c( "Tosse", "Dor de garganta", "Febre", "Coriza", "Dificuldade para respirar")

sintomas <- cbind(sintomas.nome, sintomas.n, sintomas.porcent)

colnames(sintomas) <- c("Sintomas", "Frequência", "%")

ggplot(sintomas) +
  aes(x = reorder(Sintomas, -`%`), weight = `%`) +
  geom_bar(fill =  "SkyBlue1") +
  coord_flip() +
  labs(x = "Sintomas", y = "%") +
  ylim(0, max(sintomas$`%`)+10)+
  geom_text(aes(label = paste0(sintomas$`%`,"%"), y = sintomas$`%`),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```


### RA C. Alemão - Proporção dos Fatores de Risco autorreferidos (%)

```{r, fig.width = 10}

d.has <- dados %>%
  filter(RA == "Complexo do Alemão")%>%
  group_by(FR.HAS) %>%
  tally

d.has <- d.has %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.obeso <- dados %>%
  filter(RA == "Complexo do Alemão")%>%
  group_by(FR.OBESIDADE) %>%
  tally

d.obeso <- d.obeso %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.DM <- dados %>%
  filter(RA == "Complexo do Alemão")%>%
  group_by(FR.DIABETTES) %>%
  tally

d.DM <- d.DM %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.dpco <- dados %>%
  filter(RA == "Complexo do Alemão")%>%
  group_by(FR.DPCO) %>%
  tally

d.dpco <- d.dpco %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.outros <- dados %>%
  filter(RA == "Complexo do Alemão")%>%
  group_by(FR.OUTROS) %>%
  tally

d.outros <- d.outros %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))



fatorrisco.n <- rbind(d.has[2,2], d.DM[2,2], d.dpco[2,2], d.obeso[2,2], d.outros[2,2])


fatorrisco.porcent <- rbind(d.has[2,3], d.DM[2,3], d.dpco[2,3], d.obeso[2,3], d.outros[2,3])


fatorrisco.nome <- c( "Hipertensão arterial", "Diabettes", "DPCO", "Obesidade", "Outros")


fatorrisco <- cbind(fatorrisco.nome, fatorrisco.n, fatorrisco.porcent)

colnames(fatorrisco) <- c("Fator de Risco", "Frequência", "Porcent")


ggplot(fatorrisco) +
  aes(x = reorder(`Fator de Risco`, -Porcent), weight = Porcent) +
  geom_bar(fill =  "Thistle1") +
  coord_flip() +
  labs(x = "Fatores de risco", y = "%") +
  ylim(0, max(fatorrisco$Porcent)+10)+
  geom_text(aes(label = paste0(Porcent,"%"), y = Porcent),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```



RA Maré {data-icon="fa-signal"}
=====================================  

Column {data-width=200}
-----------------------------------------------------------------------
### RA
```{r}
valueBox("Maré", icon = "fa-pencil", color= "white")
```

### Data

```{r}
valueBox(format(Sys.Date(), "%d/%m/%Y"), icon = "fa-calendar ", color= "purple")
```

### Nº de casos

```{r}

ncasos22 <- dados %>%
  filter(RA == "Maré") %>% tally

valueBox(ncasos22, icon = "fa-calculator", color = "lightblue")
```

### RA Maré - Tipo de Notificação


```{r fig.width= 10}

# TIPO DE NOTIFICAÇÃO


dados.tipo.mare <- dados %>%
  filter(RA == "Maré")   %>%
   group_by(TIPO) %>%
    tally()

dados.tipo.mare$`%` <- round(dados.tipo.mare$n/sum(dados.tipo.mare$n)*100,1)



colnames(dados.tipo.mare) <- c("Tipo de notificação", "Nº de casos", "%")

kbl(dados.tipo.mare, align = "lcc") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),  font_size = 16)


```


Column {data-width=450}
-----------------------------------------------------------------------

### RA Maré - Casos segundo SE dos 1os sintomas

```{r, fig.width = 10}

## semana epidemiolo notificação

dados.5 <- dados %>%
  filter(RA == "Maré")   %>%
  mutate(`SEMANA EPIDEMIOLÓGICA` = epiweek(DT_PRISIN),
         ANO = year(DT_PRISIN))


dados.5$`SEMANA EPIDEMIOLÓGICA` <- as.factor(dados.5$`SEMANA EPIDEMIOLÓGICA`)


dados.SE <- dados %>% 
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>%
  tally

dados.SE <- dados.SE %>% 
  filter(ANO >= 2020 & ANO <= 2021) %>%
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>% 
  summarise(sum_week_value= sum(n)) %>% 
  ungroup() %>% 
  #using aweek
  mutate(epi_date=get_date(week = `SEMANA EPIDEMIOLÓGICA`, year = ANO),
         wik_date=date2week(epi_date)
  ) 

dados.SE %>% 
  slice(-(1:3)) %>% 
  ggplot(aes(epi_date, weight = sum_week_value)) + 
  geom_bar(fill = "SeaGreen3") + 
  scale_x_date(date_breaks="1 month", date_labels = "%U-%y",
               limits = as.Date(c("2021-01-01","2021-10-15"))) +
  labs( x = "SE dos 1os sintomas", y = "Frequência") +
  theme_minimal(base_size = 18)+
  theme(axis.text.x = element_text(angle = 90))
```





### RA Maré - Faixa etária (em anos) segundo Gênero

```{r}

piramide <- dados %>%
  filter(RA == "Maré" ) %>%
  group_by(FXETARIA, SEXO) %>%
  tally

piramide$Sexo  <- piramide$SEXO
piramide$FXETARIA  <- as.factor(piramide$FXETARIA)
piramide$SEXO  <- as.factor(piramide$SEXO)

piramide$FXETARIA  <- factor(piramide$FXETARIA)
piramide$SEXO  <- factor(piramide$SEXO)

ggplot(data = piramide, 
       mapping = aes(x = FXETARIA,
                     y = ifelse(test = Sexo == "Masculino",  yes = n, no = -n), 
                     fill = Sexo)) +
  geom_bar(stat = "identity") +
  ggtitle("") +
  scale_y_continuous(labels = abs, limits = (max(piramide$n))* c(-1,1)) +
  labs(y = "Número de casos", x = "Faixa etária (em anos)") +
  scale_fill_brewer(palette = "OrRd") +
  coord_flip() +
  theme_classic(base_size = 18) +
  theme(legend.position= "bottom")


```

Column {data-width=350} 
-----------------------------------------------------------------------

### RA Maré - Proporção de Sintomas autorreferidos (%)


```{r fig.width= 10}

d.tosse <- dados %>%
  filter(RA == "Maré")   %>%
  group_by(TOSSE) %>%
  tally

d.tosse <- d.tosse %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.febre <- dados %>%
  filter(RA == "Maré")   %>%
  group_by(FEBRE) %>%
  tally

d.febre <- d.febre %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.coriza <- dados %>%
  filter(RA == "Maré")   %>%
  group_by(CORIZA) %>%
  tally

d.coriza <- d.coriza %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.garganta <- dados %>%
  filter(RA == "Maré")   %>%
  group_by(DOR.GARGANTA) %>%
  tally

d.garganta <- d.garganta %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.difculresp <- dados %>%
  filter(RA == "Maré")   %>%
  group_by(DIF.RESPIRAR) %>%
  tally

d.difculresp <- d.difculresp %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

sintomas.n <- rbind(d.tosse[2,2], d.garganta[2,2], d.febre[2,2],  d.coriza[2,2], d.difculresp[2,2])

sintomas.porcent <- rbind(d.tosse[2,3], d.garganta[2,3], d.febre[2,3],  d.coriza[2,3], d.difculresp[2,3])

sintomas.nome <- c( "Tosse", "Dor de garganta", "Febre", "Coriza", "Dificuldade para respirar")

sintomas <- cbind(sintomas.nome, sintomas.n, sintomas.porcent)

colnames(sintomas) <- c("Sintomas", "Frequência", "%")

ggplot(sintomas) +
  aes(x = reorder(Sintomas, -`%`), weight = `%`) +
  geom_bar(fill =  "SkyBlue1") +
  coord_flip() +
  labs(x = "Sintomas", y = "%") +
  ylim(0, max(sintomas$`%`)+10)+
  geom_text(aes(label = paste0(sintomas$`%`,"%"), y = sintomas$`%`),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```




### RA Maré - Proporção dos Fatores de Risco autorreferidos (%)

```{r, fig.width = 10}


d.has <- dados %>%
  filter(RA == "Maré")%>%
  group_by(FR.HAS) %>%
  tally

d.has <- d.has %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.obeso <- dados %>%
  filter(RA == "Maré")%>%
  group_by(FR.OBESIDADE) %>%
  tally

d.obeso <- d.obeso %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.DM <- dados %>%
  filter(RA == "Maré")%>%
  group_by(FR.DIABETTES) %>%
  tally

d.DM <- d.DM %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.dpco <- dados %>%
  filter(RA == "Maré")%>%
  group_by(FR.DPCO) %>%
  tally

d.dpco <- d.dpco %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.outros <- dados %>%
  filter(RA == "Maré")%>%
  group_by(FR.OUTROS) %>%
  tally

d.outros <- d.outros %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))



fatorrisco.n <- rbind(d.has[2,2], d.DM[2,2], d.dpco[2,2], d.obeso[2,2], d.outros[2,2])


fatorrisco.porcent <- rbind(d.has[2,3], d.DM[2,3], d.dpco[2,3], d.obeso[2,3], d.outros[2,3])


fatorrisco.nome <- c( "Hipertensão arterial", "Diabettes", "DPCO", "Obesidade", "Outros")


fatorrisco <- cbind(fatorrisco.nome, fatorrisco.n, fatorrisco.porcent)

colnames(fatorrisco) <- c("Fator de Risco", "Frequência", "Porcent")


ggplot(fatorrisco) +
  aes(x = reorder(`Fator de Risco`, -Porcent), weight = Porcent) +
  geom_bar(fill =  "Thistle1") +
  coord_flip() +
  labs(x = "Fatores de risco", y = "%") +
  ylim(0, max(fatorrisco$Porcent)+10)+
  geom_text(aes(label = paste0(Porcent,"%"), y = Porcent),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```



RA Vigário Geral {data-icon="fa-signal"}
=====================================  

Column {data-width=200}
-----------------------------------------------------------------------
### RA
```{r}
valueBox("Vigário Geral", icon = "fa-pencil", color= "white")
```

### Data

```{r}
valueBox(format(Sys.Date(), "%d/%m/%Y"), icon = "fa-calendar ", color= "purple")
```

### Nº de casos

```{r}

ncasos22 <- dados %>%
  filter(RA == "Vigário Geral") %>% tally

valueBox(ncasos22, icon = "fa-calculator", color = "lightblue")
```



### RA Vigário Geral - Tipo de Notificação


```{r fig.width= 10}

# TIPO DE NOTIFICAÇÃO


dados.tipo.vig <- dados %>%
  filter(RA == "Vigário Geral")   %>%
   group_by(TIPO) %>%
    tally()

dados.tipo.vig$`%` <- round(dados.tipo.vig$n/sum(dados.tipo.vig$n)*100,1)


colnames(dados.tipo.vig) <- c("Tipo de notificação", "Nº de casos", "%")

kbl(dados.tipo.vig, align = "lcc") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),  font_size = 16)

#ggplot(dados.tipo.mes) +
#  aes(x = TIPO, weight=`%`) +
#  geom_bar(fill = "#999999") +
#  geom_text(aes(label = paste0(dados.tipo.mes$`%`,"%"), y = dados.tipo.mes$`%` + 1),
#    position = position_dodge(0.9), size= 5, vjust = 0) +
#  labs(y = "%", x = "Tipo de Notificação") +
#  theme_classic(base_size = 18)

```

Column {data-width=450}
-----------------------------------------------------------------------

### RA Vigário Geral - Casos segundo SE dos 1os sintomas

```{r, fig.width = 10}

## semana epidemiolo notificação

dados.6 <- dados %>%
  filter(RA == "Vigário Geral")   %>%
  mutate(`SEMANA EPIDEMIOLÓGICA` = epiweek(DT_PRISIN),
         ANO = year(DT_PRISIN))


dados.6$`SEMANA EPIDEMIOLÓGICA` <- as.factor(dados.6$`SEMANA EPIDEMIOLÓGICA`)


dados.SE <- dados.6 %>% 
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>%
  tally

dados.SE <- dados.SE %>% 
  filter(ANO >= 2020 & ANO <= 2021) %>%
  group_by(ANO,`SEMANA EPIDEMIOLÓGICA`) %>% 
  summarise(sum_week_value= sum(n)) %>% 
  ungroup() %>% 
  #using aweek
  mutate(epi_date=get_date(week = `SEMANA EPIDEMIOLÓGICA`, year = ANO),
         wik_date=date2week(epi_date)
  ) 

dados.SE %>% 
  slice(-(1:3)) %>% 
  ggplot(aes(epi_date, weight = sum_week_value)) + 
  geom_bar(fill = "SeaGreen3") + 
  scale_x_date(date_breaks="1 month", date_labels = "%U-%y",
               limits = as.Date(c("2021-01-01","2021-10-15"))) +
  labs( x = "SE dos 1os sintomas", y = "Frequência") +
  theme_minimal(base_size = 18)+
  theme(axis.text.x = element_text(angle = 90))
```




### RA Vigário Geral - Faixa etária (em anos) segundo Gênero

```{r}

piramide <- dados %>%
  filter(RA == "Vigário Geral" ) %>%
  group_by(FXETARIA, SEXO) %>%
  tally

piramide$Sexo  <- piramide$SEXO
piramide$FXETARIA  <- as.factor(piramide$FXETARIA)
piramide$SEXO  <- as.factor(piramide$SEXO)

piramide$FXETARIA  <- factor(piramide$FXETARIA)
piramide$SEXO  <- factor(piramide$SEXO)

ggplot(data = piramide, 
       mapping = aes(x = FXETARIA,
                     y = ifelse(test = Sexo == "Masculino",  yes = n, no = -n), 
                     fill = Sexo)) +
  geom_bar(stat = "identity") +
  ggtitle("") +
  scale_y_continuous(labels = abs, limits = (max(piramide$n))* c(-1,1)) +
  labs(y = "Número de casos", x = "Faixa etária (em anos)") +
  scale_fill_brewer(palette = "OrRd") +
  coord_flip() +
  theme_classic(base_size = 18) +
  theme(legend.position= "bottom")


```

Column {data-width=350} 
-----------------------------------------------------------------------

### RA Vigário Geral - Proporção de Sintomas autorreferidos (%)


```{r fig.width= 10}

d.tosse <- dados %>%
  filter(RA == "Vigário Geral")   %>%
  group_by(TOSSE) %>%
  tally

d.tosse <- d.tosse %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.febre <- dados %>%
  filter(RA == "Vigário Geral")   %>%
  group_by(FEBRE) %>%
  tally

d.febre <- d.febre %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.coriza <- dados %>%
  filter(RA == "Vigário Geral")   %>%
  group_by(CORIZA) %>%
  tally

d.coriza <- d.coriza %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.garganta <- dados %>%
  filter(RA == "Vigário Geral")   %>%
  group_by(DOR.GARGANTA) %>%
  tally

d.garganta <- d.garganta %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.difculresp <- dados %>%
  filter(RA == "Vigário Geral")   %>%
  group_by(DIF.RESPIRAR) %>%
  tally

d.difculresp <- d.difculresp %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

sintomas.n <- rbind(d.tosse[2,2], d.garganta[2,2], d.febre[2,2],  d.coriza[2,2], d.difculresp[2,2])

sintomas.porcent <- rbind(d.tosse[2,3], d.garganta[2,3], d.febre[2,3],  d.coriza[2,3], d.difculresp[2,3])

sintomas.nome <- c( "Tosse", "Dor de garganta", "Febre", "Coriza", "Dificuldade para respirar")

sintomas <- cbind(sintomas.nome, sintomas.n, sintomas.porcent)

colnames(sintomas) <- c("Sintomas", "Frequência", "%")

ggplot(sintomas) +
  aes(x = reorder(Sintomas, -`%`), weight = `%`) +
  geom_bar(fill =  "SkyBlue1") +
  coord_flip() +
  labs(x = "Sintomas", y = "%") +
  ylim(0, max(sintomas$`%`)+10)+
  geom_text(aes(label = paste0(sintomas$`%`,"%"), y = sintomas$`%`),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```



### RA Vigário Geral - Proporção dos Fatores de Risco autorreferidos (%)

```{r, fig.width = 10}



d.has <- dados %>%
  filter(RA == "Vigário Geral")%>%
  group_by(FR.HAS) %>%
  tally

d.has <- d.has %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.obeso <- dados %>%
  filter(RA == "Vigário Geral")%>%
  group_by(FR.OBESIDADE) %>%
  tally

d.obeso <- d.obeso %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.DM <- dados %>%
  filter(RA == "Vigário Geral")%>%
  group_by(FR.DIABETTES) %>%
  tally

d.DM <- d.DM %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))

d.dpco <- dados %>%
  filter(RA == "Vigário Geral")%>%
  group_by(FR.DPCO) %>%
  tally

d.dpco <- d.dpco %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))


d.outros <- dados %>%
  filter(RA == "Vigário Geral")%>%
  group_by(FR.OUTROS) %>%
  tally

d.outros <- d.outros %>%
  mutate(Porcentagem = round(n/sum(n)*100,1))



fatorrisco.n <- rbind(d.has[2,2], d.DM[2,2], d.dpco[2,2], d.obeso[2,2], d.outros[2,2])


fatorrisco.porcent <- rbind(d.has[2,3], d.DM[2,3], d.dpco[2,3], d.obeso[2,3], d.outros[2,3])


fatorrisco.nome <- c( "Hipertensão arterial", "Diabettes", "DPCO", "Obesidade", "Outros")


fatorrisco <- cbind(fatorrisco.nome, fatorrisco.n, fatorrisco.porcent)

colnames(fatorrisco) <- c("Fator de Risco", "Frequência", "Porcent")


ggplot(fatorrisco) +
  aes(x = reorder(`Fator de Risco`, -Porcent), weight = Porcent) +
  geom_bar(fill =  "Thistle1") +
  coord_flip() +
  labs(x = "Fatores de risco", y = "%") +
  ylim(0, max(fatorrisco$Porcent)+10)+
  geom_text(aes(label = paste0(Porcent,"%"), y = Porcent),
    position = position_dodge(0.9), size= 5, hjust = -.25)  +
  theme_classic(base_size = 18)

```



Notas e Créditos  {data-icon="fa-pencil"}
=====================================  

**Notas explicativas**: 

- Os dados demonstrados neste painel são fictícios.

- Período: 01 jan de 2021 - 20 de nov de 2021.

- Exemplo de uma planilha dos casos sintomáticos respiratórios atendidos nas unidades de Atenção Primária em Saúde das RAs da AP 3.1.


**Desenvolvimento deste painel**:  Natália Paiva (Professora Adjunta de Bioestatística, IESC-UFRJ)


Este painel foi desenvolvido no software livre R (2019) usando o pacote "flexdashboard" e script de autoria própria.


**Bibliografia**:

- R Core Team (2019). R: A language and environment for statistical computing. R Foundation for
  Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.
  
- Richard Iannone, JJ Allaire and Barbara Borges (2018). flexdashboard: R Markdown Format for Flexible
  Dashboards. R package version 0.5.1.1. https://CRAN.R-project.org/package=flexdashboard  
  
  


  
Esta proposta de painel é um produto do Projeto de Extensão intitulado "Apoio às ações de vigilância epidemiológica no enfrentamento da epidemia de COVID-19" sob coordenação do Prof. Antonio José Leal Costa. 

Compartilhamos esse material com o objetivo de apoiar o desenvolvimento das ações de vigilância epidemiológica da COVID-19 no estado do Rio de Janeiro.


Nos dedicamos na elaboração de rotinas de análise dos dados e produção de informação de retorno sobre casos notificados de SG e de SRAG utilizando o software R, ferramenta de análise de dados de domínio público.


Alunos da Graduação em Saúde Coletiva da UFRJ envolidos no Projeto de Extensão:

1. Vinícius Alves Martins Farias
2. Paula Cristina Pungartnik
3. Édnei César de Arruda Santos Junior
4. Gabriela Almeida Chaves dos Santos
5. Lana dos Santos Meijinhos
6. Mariana da Silva Costa
7. Pedro Henrique Mattos Ferreira

